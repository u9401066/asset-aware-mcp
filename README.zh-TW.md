# asset-aware-mcp

> ğŸ¥ Medical RAG with Asset-Aware MCP - è®“ AI Agent ç²¾æº–å­˜å– PDF æ–‡ç»ä¸­çš„è¡¨æ ¼ã€ç« ç¯€èˆ‡çŸ¥è­˜åœ–è­œ

[![License](https://img.shields.io/badge/License-Apache_2.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)

ğŸŒ [English](README.md)

## âœ¨ ç‰¹è‰²

- ğŸ“„ **Asset-Aware ETL** - PDF â†’ Markdownï¼Œä½¿ç”¨ **PyMuPDF** è‡ªå‹•è­˜åˆ¥è¡¨æ ¼ã€ç« ç¯€ã€åœ–ç‰‡
- ğŸ”„ **Async Job Pipeline** - æ”¯æ´éåŒæ­¥ä»»å‹™è™•ç†ï¼Œè¿½è¹¤å¤§å‹æ–‡ä»¶çš„è™•ç†é€²åº¦
- ğŸ—ºï¸ **Document Manifest** - çµæ§‹åŒ–æ¸…å–®ï¼ŒAgent å¯å…ˆã€Œçœ‹åœ°åœ–ã€å†ç²¾æº–å–ç”¨è³‡æ–™
- ğŸ§  **LightRAG æ•´åˆ** - çŸ¥è­˜åœ–è­œ + å‘é‡ç´¢å¼•ï¼Œæ”¯æ´è·¨æ–‡ç»æ¯”è¼ƒèˆ‡æ¨ç†
- ğŸ”Œ **MCP Server** - é€é FastMCP æš´éœ²å·¥å…·èˆ‡è³‡æºçµ¦ Copilot/Claude
- ğŸ¥ **é†«å­¸ç ”ç©¶å°å‘** - é‡å°é†«å­¸æ–‡ç»å„ªåŒ–ï¼Œæ”¯æ´ Base64 åœ–ç‰‡å‚³è¼¸ä¾› Vision AI åˆ†æ

## ğŸ—ï¸ æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI Agent (Copilot)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ MCP Protocol (Tools & Resources)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 MCP Server (server.py)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   ingest    â”‚ â”‚  inspect    â”‚ â”‚     fetch       â”‚   â”‚
â”‚  â”‚  documents  â”‚ â”‚  manifest   â”‚ â”‚     asset       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          consult_knowledge_graph                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ETL Pipeline (DDD)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ PyMuPDF  â”‚  â”‚  Asset   â”‚  â”‚ LightRAG â”‚              â”‚
â”‚  â”‚ Adapter  â”‚â†’ â”‚  Parser  â”‚â†’ â”‚  Index   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Local Storage                         â”‚
â”‚  ./data/                                                â”‚
â”‚  â”œâ”€â”€ doc_{id}/                                          â”‚
â”‚  â”‚   â”œâ”€â”€ full.md          # Markdown Content            â”‚
â”‚  â”‚   â”œâ”€â”€ manifest.json    # Asset Map                   â”‚
â”‚  â”‚   â””â”€â”€ images/          # Extracted Figures           â”‚
â”‚  â””â”€â”€ lightrag/            # Knowledge Graph             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ å°ˆæ¡ˆçµæ§‹ (DDD)

```
asset-aware-mcp/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ domain/              # ğŸ”µ é ˜åŸŸå±¤ï¼šå¯¦é«”ã€å€¼ç‰©ä»¶ã€ä»‹é¢å®šç¾©
â”‚   â”œâ”€â”€ application/         # ğŸŸ¢ æ‡‰ç”¨å±¤ï¼šæ–‡ä»¶æœå‹™ã€ä»»å‹™ç®¡ç†ã€è³‡ç”¢æª¢ç´¢
â”‚   â”œâ”€â”€ infrastructure/      # ğŸŸ  åŸºç¤è¨­æ–½å±¤ï¼šPyMuPDF, LightRAG, æª”æ¡ˆå„²å­˜
â”‚   â””â”€â”€ presentation/        # ğŸ”´ è¡¨ç¾å±¤ï¼šMCP Server (FastMCP)
â”œâ”€â”€ data/                    # æ–‡ä»¶èˆ‡è³‡ç”¢å„²å­˜ç©ºé–“
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ spec.md              # æŠ€è¡“è¦æ ¼æ–‡ä»¶
â”œâ”€â”€ tests/                   # å–®å…ƒæ¸¬è©¦èˆ‡æ•´åˆæ¸¬è©¦
â”œâ”€â”€ vscode-extension/        # VS Code ç®¡ç†æ“´å……åŠŸèƒ½
â””â”€â”€ pyproject.toml           # uv å°ˆæ¡ˆé…ç½®
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

```bash
# å®‰è£ä¾è³´ (ä½¿ç”¨ uv)
uv sync

# å•Ÿå‹• MCP Server
uv run python -m src.presentation.server

# æˆ–é€é VS Code MCP æ“´å……åŠŸèƒ½ä½¿ç”¨
```

## ğŸ”Œ MCP å·¥å…·

| å·¥å…· | ç”¨é€” |
|------|---------|
| `ingest_documents` | åŒ¯å…¥ PDFï¼Œè§¸ç™¼ ETL pipeline (æ”¯æ´ async) |
| `get_job_status` | æª¢æŸ¥ ETL ä»»å‹™é€²åº¦ |
| `list_documents` | åˆ—å‡ºæ‰€æœ‰å·²è™•ç†çš„æ–‡ä»¶ |
| `inspect_document_manifest` | æŸ¥çœ‹æ–‡ä»¶çµæ§‹åœ°åœ– (è¡¨æ ¼/åœ–ç‰‡/ç« ç¯€) |
| `fetch_document_asset` | ç²¾æº–å–å¾—è¡¨æ ¼ (MD) / åœ–ç‰‡ (B64) / ç« ç¯€ |
| `consult_knowledge_graph` | çŸ¥è­˜åœ–è­œæŸ¥è©¢ï¼Œè·¨æ–‡ç»æ¯”è¼ƒ |

## ğŸ”§ æŠ€è¡“æ£§

| é¡åˆ¥ | æŠ€è¡“ |
|----------|------------|
| èªè¨€ | Python 3.10+ |
| ETL | **PyMuPDF** (fitz) |
| RAG | LightRAG (lightrag-hku) |
| MCP | FastMCP |
| å„²å­˜ | æœ¬åœ°æª”æ¡ˆç³»çµ± (JSON/Markdown/PNG) |

## ğŸ“‹ æ–‡æª”

- [æŠ€è¡“è¦æ ¼](docs/spec.md) - è©³ç´°æŠ€è¡“è¦æ ¼
- [æ¶æ§‹èªªæ˜](ARCHITECTURE.md) - ç³»çµ±æ¶æ§‹
- [å°ˆæ¡ˆæ†²æ³•](CONSTITUTION.md) - å°ˆæ¡ˆåŸå‰‡

## ğŸ“„ æˆæ¬Š

[Apache License 2.0](LICENSE)
